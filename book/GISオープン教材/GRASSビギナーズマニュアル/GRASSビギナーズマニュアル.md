# GRASSビギナーズマニュアル
本教材は、GRASS GIS入門者向けの実習用教材です。GRASSの機能やデータの読み込みなどについて解説しています。  
本教材を使用する際は、[利用規約]をご確認いただき、これらの条件に同意された場合にのみご利用下さい。

[利用規約]:../../../master/利用規約.md

**Menu**
----------
* [GRASS GISとは？](#GRASS GISとは？)
* [インストール](#インストール)
* [ファイル形式について](#ファイル形式について)
* [QGISでマップセットの作成](#QGISでマップセットの作成)　
* [データの読み込み](#データの読み込み)
* [マップセットをGRASSで表示する](#マップセットをGRASSで表示する)
* [GRASSにデータを追加する](#GRASSにデータを追加する)
* [機能説明](#機能説明)
* [コマンドコンソールとモジュールツリー](#コマンドコンソールとモジュールツリー)
* [レイヤの色分け](#レイヤの色分け)
* [3Dビュー](#3Dビュー)
* [属性テーブル](#属性テーブル)
* [フィールド演算](#フィールド演算)
* [レイアウト](#レイアウト)
* [参考ページの紹介](#参考ページの紹介)

**使用データ**
*  国土地理院
「 基盤地図情報　数値標高モデル　5ｍメッシュ　高松周辺（513440）」


**スライド教材**  
スライドのダウンロードは[こちら]
[こちら]:../../../../raw/master/GISオープン教材/GRASSビギナーズマニュアル/GRASSビギナーズマニュアル.pptx
----------


## <a name = "GRASS GISとは？">GRASS GISとは？
- GRASS GISは無料で利用できるオープンソースGIS
- ラスタやベクタ処理の機能が充実しており、地形分野などで活用されている。
- QGISのプラグインからGRASSの機能を呼び出すことができます。

[▲メニューへもどる]  
[▲メニューへもどる]:GRASSビギナーズマニュアル.md#menu

## インストール
![インストール](pic/grasspic_1.png)
[GRASS GISの公式ページ] にアクセスして、GRASS GIS をダウンロードする。解凍したファイルのガイドに従ってインストールを行う。  
　※QGISをダウンロードすると一緒にGRASS6.4もダウンロードされる。今回はそれとは別にGRASS7をダウンロードする。  

[GRASS GISの公式ページ]:https://grass.osgeo.org/

[▲メニューへもどる]  

## ファイル形式について
![インストール](pic/grasspic_2.png)

## <a name = "QGISでマップセットの作成">QGISでマップセットの作成　

![起動する](pic/grasspic_3.png)
QGIS2.10の場合は、QGIS Desktop2.10.1 with　GRASSを起動し、プラグイン→プラグインの管理とインストールからGRASS 6を検索し、チェックをする。GRASSプラグインが有効化される。


![画像を読み込む](pic/grasspic_4.png)
QGISでラスタを読み込む。右下から座標系を確認し、オンザフライをONにする。

![マップセットの追加](pic/grasspic_5.png)
新規マップセットをクリックし、マップセット名など必要項目を入力していく。

![マップセットの設定a](pic/grasspic_6.png)
GRASSデータのディレクトリを作成し指定する。新しいロケーション名を任意で入力する。

![マップセットの設定b](pic/grasspic_7.png)
データ座標系にあわせて、データの範囲を作成し指定する。新しいロケーション名を任意で入力する。
オンザフライをONにしておくと、現在のQGISの範囲が設定できる。

![マップセットの設定c](pic/grasspic_8.png)
新規マップセットに名前をつけ、マップセットの作成を完了させる。

### マップセットの追加 (新規作成しない場合)

![マップセットの追加](pic/grasspic_9.png)
マップセットを保存したフォルダーを参照し、位置とマップセットを追加する。

[▲メニューへもどる]  

## データの読み込み
##### ラスタの読み込み
QGISにロードされているラスタデータをGRASSで読み込む。

![ラスタ読み込みa](pic/grasspic_10.png)
GRASS Toolをクリックし、モジュールリストを開き、r.in gdal.qgisコマンドを選択する。
※モジュールツリーから選択することも可能。

![ラスタ読み込みb](pic/grasspic_11.png)
ロードされたレイヤ（QGISで読み込んでいるレイヤ）を選択し、出力ラスタ名を入力する。
「実行」をクリックし、処理が成功したら「出力を見る」をクリックする。

![ラスタ読み込みc](pic/grasspic_12.png)
先ほど作成したラスタマップが表示される。
GRASSデータセットの中に,QGISで表示しているラスタを読み込み、GRASSで処理できる準備ができた。

##### ベクタの読み込み
QGISにロードされているベクタデータをGRASSで読み込む。

![ベクタの読み込みa](pic/grasspic_13.png)
ベクタをインポートする場合は、ＱＧＩＳでベクターを読み込んでおき、v.in org.qgisコマンドを実行する。
※GRASS6.4でインポートしたベクタは、GRASS7では表示されないことがあるので注意する。

![ベクタの読み込みb](pic/grasspic_14.png)

[▲メニューへもどる]  

## <a name = "マップセットをGRASSで表示する">マップセットをGRASSで表示する
##### ※GRASS 7.0.1を利用している

![ベクタの読み込みb](pic/grasspic_15.png)
参照からマップセットの保存ディレクトリを選択する（新規に作成する場合は、ディレクトリを作成する）。  
すでに、QGISで作成しているため、自動的にロケーションとマップセットが展開する（新規に作成する場合は、Newから作成する）。  
マップセットを選択し、「 Start GRASS session 」を実行する。

### 画面説明
![画面説明](pic/grasspic_16.png)

### マップセットからラスタデータを読み込む
![GRASSラスタ読み込み](pic/grasspic_17.png)
ラスターマップの追加から、作成したマップセットのラスタを選択し、読み込む。

[▲メニューへもどる]  

## <a name = "GRASSにデータを追加する">GRASSにデータを追加する
![GRASSベクタ読み込みa](pic/grasspic_18.png)
ベクトルデータのインポートから、.shpファイルを参照し、インポートする。

![GRASSベクタ読み込みb](pic/grasspic_19.png)
ベクトルレイヤが、マップセットに追加された。

[▲メニューへもどる]  

## 機能説明

![機能説明a](pic/grasspic_20.png)
①新規マップ表示　②新規ワークスペース作成　③ワークスペースの読み込みと書き出し　④マップセット内のデータ読み込み（④の右側のボタンは読み込むデータの形式によって選択する）　⑤データの編集　⑥属性テーブルの表示　⑦データのインポート　⑧ラスタ計算機　⑨幾何補正

![機能説明b](pic/grasspic_21.png)
ファイル：ワークスペース、データのインポートエクスポートなど  
設定：ロケーション、作業環境の設定など

![機能説明c](pic/grasspic_22.png)
ラスター：ラスタ処理（地形解析、水文解析など）  
ベクトル：ベクタ処理（バッファ、ネットワーク分析など）

![機能説明d](pic/grasspic_23.png)
画像：画像の処理（色分けやＲＧＢ合成など）  
3D raster：3D表示に関する処理（断面図など）

[▲メニューへもどる]  

## コマンドコンソールとモジュールツリー
※　レイヤツリー（レイヤが表示されるウインドウの下に切り替えがある）
![コマンドコンソールとモジュールツリーa](pic/grasspic_24.png)
コマンドコンソール：赤枠内にコマンドを入力すると実行される。
入力途中で、該当するコマンドを先読みする。  
モジュールツリー：赤枠内のツリーから、処理を選択する。
+ボタンをおすと処理が表示される。

[▲メニューへもどる]  

## レイヤの色分け
##### ベクタデータの色分け
![色分けa](pic/grasspic_25.png)
ラインの色を黒から赤へ変更する。

![色分けb](pic/grasspic_26.png)
ラインの色が黒から赤に変更された。

##### ラスタデータの色分け
![色分けc](pic/grasspic_27.png)
ラスタの値に応じて色分けを行うため、「Manage color rules Interactively」をクリックする。
ラスターマップを選択し、分類数と値を入力する。

![色分けd](pic/grasspic_28.png)
左の図のように、用意されている配色を選択することもできる。  
右の図のように、任意で値を入力することもできる。

[▲メニューへもどる]  

## <a name = "3Dビュー">3Dビュー
![3Ｄビューa](pic/grasspic_29.png)
DEMの標高値を利用して3D表示を行うため、2Dビューを3Dビューに変更する。

![3Ｄビューb](pic/grasspic_30.png)
3Dビューでは、値などを変更することや地図の視点を変更することができる。
Z鉛直の値を変更すると、地形の誇張の強弱が変更できる。

[▲メニューへもどる]  

## 属性テーブル
![属性テーブル](pic/grasspic_31.png)
レイヤを選択した状態で、属性テーブル表示ボタンをクリックすると、属性テーブルが表示される。

### フィールドの追加
![フィールドの追加](pic/grasspic_32.png)
列名を入力し、データの型を選択し、加算をクリックするとフィールドが追加される。

[▲メニューへもどる]  

## フィールド演算
##### ライン長を計算する
![フィールド演算a](pic/grasspic_33.png)
新規に作成したフィールドの上で右クリックし、「計算」から「ライン長」を選択する。

![フィールド演算b](pic/grasspic_34.png)
各路線のライン長が計算できた（ディゾルブしていないため、ぶつ切りの路線になっている）。

![カラーフィールドa](pic/grasspic_35.png)
color フィールド（文字型：varchar） を作成する

![カラーフィールドb](pic/grasspic_36.png)
右クリックで、Field calculatorを選択して、国道とそれ以外で色分けを行う。

![分類](pic/grasspic_37.png)
**UPDATE データ名 SET 計算したいフィールド名  
 = 入力したい値 WHERE 分類に用いるフィールド = 分類に基づく値**

 ![分類表示](pic/grasspic_38.png)
 ベクトルからカラー調整、「Manage color rules Interactively」を選択する。

![属性分類a](pic/grasspic_39.png)
 属性列をチェックし、カラーテーブルを選択すると、エラーが表示される。

![属性分類b](pic/grasspic_40.png)
属性テーブルを開くと、GRASSRGBのフィールドができている。
このフィールドにcolorフィールドをコピーする

![属性分類c](pic/grasspic_41.png)
GRASSRGBのフィールドを選択し、列を追加をクリックする。
エラーがでるが色分けができているため、OKをクリックする。

[▲メニューへもどる]  

## レイアウト
![レイアウトa](pic/grasspic_42.png)
ファイルから、カートグラフィックコンポーザーをクリックし実行する。

カートグラフィックコンポーザーが起動したので、地図などを挿入する。
![レイアウトb](pic/grasspic_43.png)
①地図の範囲を選択する（一番最初に設定する） ②ラスタマップの追加 ③ベクタマップの追加 ④凡例、方位、縮尺の追加 ⑤地図の書き出し（PDF）

![レイアウトc](pic/grasspic_44.png)
地図の範囲を設定し、ラスタマップを追加する。

![レイアウトd](pic/grasspic_45.png)
ラスタマップが追加されたので、ベクタラインも追加する。
マップセットから、道路ラインを選択し、加算をクリックする。

![レイアウトe](pic/grasspic_46.png)
ラスタマップとベクタマップの凡例を整える。
ベクタマップの凡例の表示名は、ラベルの追加から可能。
追加できたら、追加アイテムを選択し、配置を変更する。

![レイアウトf](pic/grasspic_47.png)
長さを設定し、単位を選択する（今回はデフォルトを使用）。
縮尺バーのデザインを選択し、OKをクリックする。
追加されたら、追加アイテムの配置を変更する。

![レイアウトg](pic/grasspic_48.png)
方位記号を追加する。
デザインを選択し、スタイルでサイズを整える
追加できたら、追加アイテムを選択し、配置を変更する。

![レイアウトh](pic/grasspic_49.png)
配置が完了したので、PDFで書き出す（プレビューはできるがうまく表示されない）。

![レイアウトi](pic/grasspic_50.png)
PDFでマップが表示できた。

[▲メニューへもどる]  

## 参考ページの紹介  
![参考](pic/grasspic_51.png)
①https://grass.osgeo.org/  
②http://foss4g.kii.gscc.osaka-cu.ac.jp/moodle/

[▲メニューへもどる]  

**その他のライセンス**  
本教材で利用しているキャプチャ画像の出典やクレジットについては、[その他のライセンスについて]よりご確認ください。
[その他のライセンスについて]:../その他のライセンスについて.md
