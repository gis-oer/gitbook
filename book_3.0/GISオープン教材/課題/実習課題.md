#実習課題について

**Menu**
--------
* [第一回課題（20160929）](#第一回課題（20160929）)
* [第二回課題（20161006）](#第二回課題（20161006）)
* [第三回課題（20161006）](#第三回課題（20161013）)
* [第四回課題（20161020）](#第四回課題（20161020）)
* [第五回課題（20161027）](#第五回課題（20161027）)
* [第六回課題（20161108）](#第六回課題（20161108）)


>実習時の注意点やメモを[作業メモ]をご参照ください。

## <a name="第一回課題（20160929）"></a>第一回課題（20160929）

### 本日の課題
無償で利用出来るデータを活用し、以下の課題1と2に該当する地図を作成しなさい。
提出する地図は、凡例、方位、縮尺バー、タイトル（学籍番号、氏名、地図名）をレイアウトしたものとします。本課題と対応する教材は、[QGISビギナーズマニュアル]および[GRASSビギナーズマニュアル]の教材となります。

**課題１**
QGISとプラグインを用いて、任意の地域の地図を作成しなさい。なお、使用するタイル（背景地図）は基本測量成果に該当しないものとする。
（必要な場合は、サンプルデータ[fkuchiyama_sample.zip](https://raw.githubusercontent.com/yamauchi-inochu/demo/master/GIS%E3%82%AA%E3%83%BC%E3%83%97%E3%83%B3%E6%95%99%E6%9D%90/%E8%AA%B2%E9%A1%8C/sample/fkuchiyama_sample.zip)を使用すること）

**完成例**

![完成例](pic/Q1.png)

**手順**

① サンプルデータを読み込む
② タイルレイヤープラグインかOpenLayersPluginを用いて背景地図を読み込む
③ 地図をレイアウトする

#### 学習ポイント：空間データの特徴とGISソフトウェアの活用

* ベクトルデータとラスターデータの違い
* QGISとプラグインについての理解
* 属性テーブルとプロパティについての理解
* 地図のレイアウト

※　提出時に図のタイトル、名前、学籍番号を記載すること（方法：プリントコンポーザーから、新規ラベルの追加 > アイテムプロパティ > メインプロパティ（タイトル等の入力） > 外観,フォント（文字のサイズ調整））

------

**課題2**
GRASS GISを用いて、高松市の地形(標高)概観図を作成しなさい。
※20160929の実習では、課題2は提出しなくてよい

**手順**

① QGISを用いてマップセットを作成する
② GRASS GISでマップセットを読み込む
③ カラーを調整し、地図をレイアウトする

![完成例](pic/G1.png)

#### 学習ポイント：GRASS GISの操作

* マップセットが作成できたか

[△メニューへもどる]
-------------
## <a name="第二回課題（20161006）"></a>第二回課題（20161006）

### 本日の課題
無償で利用出来るデータを活用し、以下の1〜3に該当する地図を作成しなさい。
提出する地図は、凡例、方位、縮尺バー、タイトル（学籍番号、氏名、地図名）をレイアウトしたものとします。
課題提出は、課題フォームより行うこととする。本課題と対応する教材は、[既存データの地図データと属性データ]および[空間データ]の教材となります。


**課題１:旧測地系と新測地系**
[政府統計局e-stat]（平成２２年国勢調査（小地域））を利用し、日本測地系平面直角座標系・Shape形式と世界測地系平面直角座標系・Shape形式のデータを用いて、両データが重なり合わない地図を作成しなさい。
※　最新の測地系はJGD2011であるが、QGIS2.8.4ではJGD2011の変換ができないため、本実習ではJGD2000を新測地系としている（2.14は、JGD2011に対応）。

**完成例**
![完成例](pic/8-1.png)

**手順**
①　e-statから任意の地域の異なるシェープファイル（投影座標系のもの）をダウンロードする
②　QGISでデータを表示する（デフォルトではずれて表示されないため、右下のボタンから、オンザフライ投影のチェックをはずす）
③　QGISビギナーズマニュアルを参考に、地図をレイアウトする
④　レイアウト後に旧測地系データを新測地系に変換する（地図データが重なればOK）
⑤　QGISの作業ファイル（.qgs）に任意の名前をつけ保存し、画面を閉じる

#### 学習ポイント：測地系
GISでは、データ分析をする前にデータの測地系を整える必要があります。この作業を行わないと位置のズレが生じ、データの処理が行えない場合があります。異なった測地系のデータを扱う場合は、以下の項目への理解が必要となります（わからない単語はインターネットで調べてください）。

* 地理座標系と投影座標系の違い
* 平面直角座標系第◯系の意味
* 旧測地系と新測地系の違い
* 座標系の変換手法

-------
**課題2：ジオリファレンス**
鯖江市のオープンデータより古地図007と基盤地図情報2500基本項目鯖江市道路をダウンロードし、それをもとにGCPを取得し、画像の位置あわせを行った地図を作成しなさい（なお、基盤地図情報の取得変換ができない場合は、地理院タイル等を利用すること）。

**完成例**
![完成例](pic/8-2.png)

**手順**
① [鯖江市のオープンデータ](https://www.city.sabae.fukui.jp/about_city/opendata/data_list/jpeg-sabae-chizu.html)より古地図007をダウンロードする。
② [sabae_sample](https://raw.githubusercontent.com/yamauchi-inochu/demo/master/GIS%E3%82%AA%E3%83%BC%E3%83%97%E3%83%B3%E6%95%99%E6%9D%90/%E8%AA%B2%E9%A1%8C/sample/sabae_sample.zip)とタイルレイヤプラグインを用いて地理院タイル（標準地図など）を読み込んでおく（高い位置精度を求める場合は、基盤地図情報の道路縁等を用いることが望ましい。）
④ 古地図を読み込みQGISのジオリファレンサーを起動する
⑤ ジオリファレンサーの利用法を参考に、古地図007にGCP(Ground Control Point)を付加する(完全には一致しないため、おおまかでよい)
⑥ QGISビギナーズマニュアルを参考に、地図をレイアウトする(古地図のプロパティを開き、画像を透過すると良い)
⑦ QGISの作業ファイル（.qgs）に任意の名前をつけ保存し、画面を閉じる

※本来は精度を求めるため、ベクトルデータを用いてジオリファレンスをすることが多い。しかし、本実習ではQGIS2.8がJGD2011に対応していないことから、基盤地図情報（道路縁など）のような高精度ベクトルデータを用いていない。

#### 学習ポイント：ジオリファレンス
* ジオリファレンスとは（どのようなときに必要な処理か？）

-------

**課題3：ジオコーディング**
サンプルデータ[susono_emergency_shelter.csv](https://raw.githubusercontent.com/yamauchi-inochu/demo/master/GIS%E3%82%AA%E3%83%BC%E3%83%97%E3%83%B3%E6%95%99%E6%9D%90/%E8%AA%B2%E9%A1%8C/sample/susono_sample.zip)の住所を用いて、ジオコーディング（アドレスマッチング)を行い地図を作成しなさい。

**完成例**
![完成例](pic/8-3.png)

**手順**
① CSVアドレスマッチングサービスを用いて、サンプルデータに位置情報（X、Y）を付加する。
② CSVデータを読み込みシェープファイルに変換する。
③ 変換したシェープファイルの座標系を平面直角座標第８系に変換する
④ QGISビギナーズマニュアルを参考に、地図をレイアウトする(古地図のプロパティを開き、画像を透過すると良い)
⑤ QGISの作業ファイル（.qgs）に任意の名前をつけ保存し、画面を閉じる


#### 学習ポイント：ジオコーディング
* ジオコーディングとは（どのような時に必要な処理か？）

[△メニューへもどる]

-------

## <a name="第三回課題（20161013）"></a>第三回課題（20161013）

### 本日の課題:新規ラスタデータとベクトルデータの作成練習
ベクトルデータとラスターデータ（課題データ）を用いて、以下の課題1に該当する地図を作成してください。
提出する地図は、凡例、方位、縮尺バー、タイトル（学籍番号、氏名、地図名）をレイアウトしたものとします。
課題提出は、課題フォームを利用してください。本課題と対応する教材は、[視覚的伝達]および[空間データの結合・修正]の教材となります。

**課題１:ベクトルデータの加工と地図作成**
課題データと地理院タイル（東日本大震災被災地震災後オルソ画像（2012年10月～2013））を用いて完成例のような画像を作成し、課題フォームより提出してください。課題の作成には、下記の手順と[空間データの結合・修正]の教材を参考にしてください。タイルレイヤプラグインで用いるTSVファイルは、第1回の課題データに含まれています
(使い方は[作業メモ]を参照)。

>課題データは、基盤地図情報数値標高モデル（5ｍDEM）を変換し、複数のラスタを結合した後に、平面直角座標系へ座標変換を行ったものである。


**完成例**
![kadai](pic/10-1.png)

**手順**

① 課題データをQGISで読みこむ。
② 旧北上川右岸の日和山を中心とし、ラスタデータを任意の範囲で切り抜き、新規ラスタの配色をプロパティから調整する（任意の値で設定）。
③ 10m間隔の等高線を抽出する。
④ ポイントの作成：地理院タイル（標準地図等）や課題データを利用し、任意の5地点の標高を調べポイントを作成する。属性は、id(Integer,幅2)、地名(String,幅20)、標高(Real,幅５〜６,精度2~3)とし、属性テーブルは、Id(通し番号)、付近の地名（もしくは建物名）、標高値を記入する。標準地図から標高値を求める場合は、地図から標高点を探す。ラスタから標高値を求める場合は、レイヤウィンドウでレイヤを選択した状態で、地物情報表示ツールをオンにする（アイコンをクリックする）。調べたい地点をクリックすると情報が表示される。
⑤ ラインの作成：タイルレイヤプラグインを用いて背景地図（東日本大震災被災地震災後オルソ画像（2012年10月～2013））を表示し、旧北上川の橋をトレースする（なぞる）。※ラインの新規作成は、作成後右クリックで新規レイヤとして反映される。
⑥ ポリゴンの作成：ライン作成時に利用した空中写真を用いて、日和山の植生が多くみられる部分のポリゴンを作成する（おおまかでよい）。※ポリゴンの新規作成は、作成後右クリックで新規レイヤとして反映される。
⑦ 各レイヤごとに色分けやラベル表示を行う。
⑧ 地図をレイアウトし、提出する。

#### 学習ポイント
* ラスタデータの結合・切り抜き
* 新規ベクトルレイヤの作成手法
* ベクトルデータの特徴
* 各レイヤのスタイル調整

-----------

**任意課題（余裕があれば）:カルトグラムの作成**
[政府統計局e-stat]から国勢調査（小地域）のデータ（市区町村の町丁目人口）を用いてカルトグラム(統計データに基づいて面積や距離を変形させた地図)を作成してください。

> 東北大学 空間計画科学研究室 [カルトグラムとは?](http://www.plan.civil.tohoku.ac.jp/inoue/research/cartogram/)

**完成例**
![kadai](pic/21-1.png)

**手順**
①[政府統計局e-stat]のページから、「平成22年国勢調査（小地域）」を選択し（統計表は任意で指定する）、市区町村の境界データ（世界測地系平面直角座標系・Shape形式）をダウンロードする。
②QGISでレイヤをデータを読み込み、画面左側に表示されるレイヤの一覧から対象のデータの上で右クリックし属性テーブルを開く。属性テーブルにJINKOの項目があるかを確認する。JINKOの値に0があると計算できないため、対象のテーブルを削除するか、値を1とする。
③QGISの「プラグインの管理とインストール」から「Cartogram」プラグインをインストールする。
④Cartogramプラグインを起動し、JINKOの値を用いてカルトグラムを作成する。
⑤レイヤのプロパティを開き値を色分けする（人口ごとに色分けする/正確に分類する場合は、分類数の設定にはスタージェスの公式等を用いると良い）。
⑥地図をレイアウトする。

-------------

## <a name="第四回課題（20161020）"></a>第四回課題（20161020）

### 本日の実習と課題：基本的な空間解析とネットワーク分析
　前回までの実習で、QGISを用いたGISソフトウェアの基本操作と空間データ（ラスターデータやベクトルデータ）の作成、改変、座標変換等について学習しました。本実習では、空間データから新たなデータを計測する手法および複数の空間データの位置関係から新規データの作成や距離の計測を行います。
　課題1としてGISソフトウェア上で地物の大きさを計測する手法を学びます。課題2では、ベクトルデータの形状を用いて新規のデータを作成する手法を学びます。課題3では、道路データを用いて任意の地点間の最短経路検索を行うものです。無償で利用出来るデータを活用し、以下の1～3に該当する課題を行い、課題フォームより提出または回答してください。
　提出する地図は、凡例、方位、縮尺バー、タイトル（学籍番号、氏名、地図名）をレイアウトしたものとします。本課題と対応する教材は、[基本的な空間解析]および[ネットワーク分析]の教材となります。
　本実習と関係するGIS理論や概念などは、各教材の上段にリンクされている講義用教材を参照してください。

**実習用データ**
　実習をはじめる前に、以下のデータをダウンロードしてください。なお、すべてのデータをJGD2000の平面直角座標系第Ⅵ系で統一する。e-satのデータは、世界測地系、JGD2000の平面直角座標系第Ⅵ系でダウンロードする。国土数値情報のデータはダウンロード後に「JGD2000の平面直角座標系第Ⅵ系」へ座標変換する。国土数値情報データの読み込み時に空間参照設定のウィンドウが表示されたら、JGD2000を選択する（今回の場合）。

* [国土数値情報] 奈良県の行政区域、学校、河川、道路データ
　※道路データは、旧 統一フォーマット形式GML(JPGIS2.1)からダウンロードする。
* [政府統計局e-Stat] 奈良市、大和郡山市の境界データ（統計データは不要なため任意のもので良い）

  >ダウンロード手法は、[既存データの地図データと属性データ]の教材を参考とする。座標系の変換手法は[空間データの教材中の投影変換（地理座標系から投影座標系）](https://github.com/yamauchi-inochu/demo/blob/master/GIS%E3%82%AA%E3%83%BC%E3%83%97%E3%83%B3%E6%95%99%E6%9D%90/08_%E7%A9%BA%E9%96%93%E3%83%87%E3%83%BC%E3%82%BF/%E7%A9%BA%E9%96%93%E3%83%87%E3%83%BC%E3%82%BF.md#投影変換地理座標系から投影座標系)の教材を参考とする。

-----------------

**課題１:GISを用いた周長と面積の自動計測**
　GISで示される地物は、位置や形状が座標で管理されています。そのためGIS上で、周長や面積計算を行うことができます。課題1は、属性テーブルから自動で面積と周長を計算する手法を学ぶものです。奈良県のデータを[国土数値情報]からダウンロードし、以下の手順と[基本的な空間解析]の教材を参考に、処理を行い課題フォームの質問（課題1）に回答してください。

**手順**
1. QGISで、[国土数値情報]からダウンロードした奈良県の行政区域を読み込む。
2. 編集モード切替ボタンをクリックし、属性テーブルを開く。
3. 新規属性テーブルを作成し、各市町村ポリゴンごとに周長を計測する。
4. 同じように新規属性テーブルを作成し、各市町村ポリゴンごとに面積を計測する。
5. 属性テーブルから山添村を探し、周長と面積確認し、課題フォームの質問に回答する。
6. 編集モード切替ボタンを再度クリックし、編集を完了させる。
※ 編集を完了（保存）しないとデータは更新されない。

-----------------

**課題2:ベクトルデータの形状を用いた新規レイヤの作成**
　ベクトルデータには、形状、位置、属性等が含まれています。lこの課題では、それらの情報を解析し新規レイヤを取得する手法を学びます。GISで解析をする場合、空間データの範囲が適切であるかということが重要になります。例えば東京都の駅数を計算する場合には、東京都の範囲のみのデータで十分ですが、国土数値情報でダウンロードできるデータは全国分のものになります。この場合、分析に必要のない範囲のデータを含んでいるため、分析用に東京都の範囲のデータを抽出する必要があります。課題2では、必要な範囲を求め、レイヤとして作成する手法を学ぶものです。以下の手順と[基本的な空間解析]の教材を参考に、奈良県内の学校のうち、奈良市と大和郡山市に位置するものを抽出し、課題フォームの質問（課題2）より地図をアップロードしてください。なお、提出する地図は、位置関係が分かるように範囲内の河川（または道路:課題3との関係上道路データの方が望ましい）が抽出されたものとします。
  >以下の用語のリンク先は、[PSCO用語集](http://www.pasco.co.jp/recommend/word/word092/)を利用

**完成例**
![kadai](pic/11-1.png)

**手順**
1. [政府統計局e-stat]からダウンロードしたデータと課題1で使用したデータを読み込む。
2. 奈良市と大和郡山市のポリゴンを一つに、[マージ](http://www.pasco.co.jp/recommend/word/word092/)する。
3. マージしたポリゴンを行政界のないポリゴン（奈良市と大和郡山市が一つになっている）にするため、[デイゾルブ](http://www.pasco.co.jp/recommend/word/word091/)する。
4. 河川レイヤ（または、道路）を読み込み、対象範囲を用いて[インターセクト](http://www.pasco.co.jp/recommend/word/word094/)する（対象範囲の切り取りのため）。
5. 奈良市と大和郡山市の学校、行政区ポリゴン、河川などのレイヤをレイアウトし、地図を作成する（完成例を参照）

---------

**課題3:QGISで最短経路検索**
　課題3は、ネットワーク分析を行うものです。ネットワーク分析とはネットワークデータ（ライン等）を用いて、経路検索や到達圏分析などを行うものです。詳しくは、[ネットワーク分析]の教材を参照してください。課題3は、QGISで簡単にできるネットワーク分析の手法として最短経路検索の手法を学ぶものです。以下の手順と[ネットワーク分析]を参考に、任意の2点間の最短経路（標高などのコストを含まない）を求め、課題フォームの質問（課題3）に回答してください。なお、分析用のデータは、課題2で学んだ手法を用いて作成してください。

**完成例**
![kadai](pic/12-1.png)

**手順**
1. 課題2で作成した奈良市と大和郡山市がマージされたポリゴンをもちいて道路を抽出する。
2. レイヤウィンドウのポイントデータの上で右クリックし、プロパティからラベルを表示する。
3. 上段ウィンドウのアイコンのないグレーの個所で右クリックし、最短経路にチェックをいれ、道路グラフプラグインを起動する。
※表示されない場合は、プラグインの管理とインストールでチェックが有効になっているか確認する。
4. ベクタ＞道路グラフをクリックし、使用するラインレイヤを設定し、「OK」をクリックする。
※ネットワーク分析では、分析用にポイントと接合したグラフ（ライン）を作成する(今回の課題では、プラグインを使ってその処理を省略しているが、GRASS GISのネットワーク分析ではグラフの作成手法を解説している)。
5. レイヤウィンドウで道路を選択した状態で、分析したい開始点と終了点の右横アイコンをクリックし、地図上で任意の2地点（学校のポイント付近）地点をクリックする（座標を設定する）。その後、計算をクリックすると長さと時間が算出される。
6. 最短経路ウィンドウから長さと時間を確認し、課題フォームの質問に回答する（記入欄に「○○学校と○○学校との最短距離は○○.○○kmでした」の○○の語句を埋めて回答してください）。

## <a name="第五回課題（20161027）"></a>第五回課題（20161027）
### 本日の課題
　前回の実習では、空間データの位置や形状を用いて、面積等の計測や新規データの作成（マージ、ディゾルブ、ユニオン、インターセクト）などを行いました。本日の実習では、点データ（point）データから、新たな領域のデータを作成する手法と領域内の点データを計測および数に応じて可視化する手法を学びます。課題1では、[国土数値情報]からダウンロードした点データを用いて、その点から一定の領域をポリゴンとして抽出する手法を学びます。課題2～4では、領域内に含まれるポイント数を計測し、可視化する手法を学びます。以下の1～4に該当する課題を行い、課題フォームより地図提出または質問に回答してください。

　提出する地図は、凡例、方位、縮尺バー、タイトル（学籍番号、氏名、地図名）をレイアウトしたものとします。本課題と対応する教材は、[領域分析]および[点データの分析]の教材となります。
　本実習と関係するGIS理論や概念などは、各教材の上段にリンクされている講義用教材を参照してください。とくに点データの分析の講義用教材の閲覧を推奨します。

**実習用データ**
　実習をはじめる前に、以下のデータをダウンロードしてください。なお、すべてのデータをJGD2000の平面直角座標系第Ⅲ系で統一してください。国土数値情報のデータはダウンロード後に「JGD2000の平面直角座標系第Ⅲ系」へ座標変換する。国土数値情報データの読み込み時に空間参照設定のウィンドウが表示されたら、JGD2000を選択する（今回の場合）。表示されない場合は、プロパティ>一般情報>空間参照システムからJGD2000を設定後、名前を付けて保存で平面直角座標系を設定してから変換を行う。

* [国土数値情報] 「国土交通省国土政策局「国土数値情報（島根県　行政区域(H28)、消防署（H24）、医療機関データ（H26））」

  >ダウンロード手法は、[既存データの地図データと属性データ]の教材を参考とする。座標系の変換手法は[空間データの教材中の投影変換（地理座標系から投影座標系）](https://github.com/yamauchi-inochu/demo/blob/master/GIS%E3%82%AA%E3%83%BC%E3%83%97%E3%83%B3%E6%95%99%E6%9D%90/08_%E7%A9%BA%E9%96%93%E3%83%87%E3%83%BC%E3%82%BF/%E7%A9%BA%E9%96%93%E3%83%87%E3%83%BC%E3%82%BF.md#投影変換地理座標系から投影座標系)の教材を参考とする。また、プロパティ>一般情報>空間参照システムで、座標系を選択してもデータそのものの座標は変換されない（もともとの座標系を選択しておく必要がある）。変換する場合は新たにデータを書き出す＝「名前を付けて保存」する必要がある（詳しくは[作業メモ]を参照）。

-----------------
**課題１:消防署から5㎞のバッファと1㎞ごとのバッファの作成**

  　以下の手順と[領域分析]の教材(とくに、「バッファによる領域分析」の項目)を参考に、[国土数値情報]からダウンロードした消防署のデータを用いて、5㎞の[バッファ](http://www.pasco.co.jp/recommend/cook/cook062/)を作成する。作成するバッファは消防署から5㎞のものと5㎞間を1㎞ごとに区分けした多重リングバッファを作成後、地図をレイアウトし、課題フォームより提出してください。
  　バッファは、対象物からある一定の領域を求める処理です。バッファで抽出された領域は、例えば、コンビニエンスストアの新規出店者が、出店するコンビニから1000m以内の地物を検索したい場合等に、分析用の領域ポリゴンとして使われます。課題1では、バッファ（分析用の領域ポリゴン作成）のみ行います。

**完成例**
![kadai](pic/13-1.png)
※ 凡例中の消防署から5㎞圏内は、各消防署から5㎞の範囲ではなく、各消防署からの5㎞圏内を算出し融合したもの。

※ 凡例の記載については、各自で工夫すること。

**手順**

1. ダウンロードしたデータ（行政区域、医療機関、消防署）をQGISで読み込む
2. ベクタ＞空間演算ツール＞バッファから半径5㎞のバッファを作成する。
※設定でバッファの結果を融合にチェックをいれておく。
3. 1㎞ごとの多重リングバッファを作成するため、プラグインの管理とインストールから、Multi-distance bufferをインストールする。
4. Multi-distance bufferプラグインを起動し、多重リングバッファを作成する。
5. 地図をレイアウトし、課題フォームより提出する。地図は、医療機関、消防署からの5㎞バッファ、1㎞ごとの多重リングバッファ、行政区域が入っているものとする。レイアウトについては、[QGISビギナーズマニュアル]と[作業メモ]を参照。また、行政区域のラベル表示は任意とする（その場合ディゾルブ処理をすると見やすい）

---------------

**課題2:10㎞メッシュ内の医療機関数の計測**

　点データを分析する際は、分析に用いる領域の形状や大きさに影響されます。課題2では、対象地域内に均一な大きさのメッシュポリゴンを作成し、メッシュ内に含まれるポリゴンを計測する手法を学びます。この手法は、行政区域などに影響されずポイントの密度を計測するのに有効です。以下の手順と[点データの分析]教材の[メッシュによる点密度の分析](https://github.com/yamauchi-inochu/demo/blob/master/GIS%E3%82%AA%E3%83%BC%E3%83%97%E3%83%B3%E6%95%99%E6%9D%90/14_%E7%82%B9%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%88%86%E6%9E%90/%E7%82%B9%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%88%86%E6%9E%90.md#メッシュによる点密度の表示)の項目を参考に処理を行い、課題2の質問に回答してください。

**完成例**
![kadai](pic/14-1.png)

**手順**

1. プラグイン＞プラグインの管理とインストールから、MMQGISプラグインを検索し、インストールする。
2. 10㎞メッシュを作成する（メッシュは、現在の表示領域で作成するため注意する）。
3. メッシュ内のポイントを計算する（警告が出た場合は、作成した10㎞メッシュを新しく名前を付けて保存で書き出し、再度実行する）。
4. メッシュ内のポイント数で色分けする（段階は任意で調整）。
※ 数値として色分けできない場合は、属性テーブル>編集モードオン>フィールド計算機>新しいフィールドを作成するをチェックする。出力フィールド名を任意で入力し、出力フィールドタイプを整数値にする。検索ウィンドウの下からフィールドと値をクリックし、病院数を計算したフィールドをダブルクリックする。左のウィンドウに計算したフィールドのカラム名が表示されたのを確認し、OKをクリックする。この処理を行ったうえで、値の配色を行う。

5. 課題フォームの質問に回答する。

#### ポリゴン内のポイント計算ができない(QGIS2.16以上の場合)
　QGIS2.18等の最新版では、ベクトルメニューから解析ツールの「ポリゴン内のポイント数」が選択できない。その場合は、プロセッシングツールかMMQGISプラグインを使用する。

* プロセッシングツールの場合・・・・プロセッシング(c)＞ツールボックスを起動し、検索ウィンドウに「points in polygon」と入力すると、「ポリゴン内のポイント数」が利用できる。

* MMQGISの場合・・・プラグイン(p)>プラグインの管理とインストールからMMQGISをインストールする。MMQGIS>Combine>Spatial Joinを選択する。上から、10kmメッシュ（Output Shape Layer）、Contain(Spatial Operation)、病院（Data Layer）、Sumを設定し、出力ファイルの名前とパスを設定しOKをクリックする。文字化けしていたら、プロパティ>エンコーディングをutf-8にする。

---------------

**課題3:行政区ポリゴンを用いたポイント数の計測**

　課題3では、行政区域のポリゴンを用いて、行政区内の医療機関を計測する手法を学びます。以下の手順と[点データの分析]の教材を参考に分析を行い、課題3の質問に回答してください。

**完成例**
![kadai](pic/14-2.png)

**手順**

1. 属性テーブルを市町村ごとに統一して作成するため、行政区ポリゴンを読み込み市町村でディゾルブする。
2. 課題2と同様の手法で、市町村ごとの医療機関数を求める。
3. 課題フォームの質問に回答する。

---------------

**課題4:カーネル密度分析によるヒートマップの作成**

　医療機関のデータを用いて、[カーネル密度分析](http://club.informatix.co.jp/?p=1176)を実行し、課題4の質問に回答してください。カーネル密度分析は犯罪発生マップなどに用いられる手法で、カーネル関数を用いてポイントの分布密度を連続的な密度局面としてモデル化する手法です（詳細は上記のリンクを参照）。今回の場合は、医療機関数を病人の発生個所と仮定しています。分析には、以下の手順と[点データの分析]教材のカーネル密度分析の教材が参考になります。

**完成例**
![kadai](pic/14-3.png)

**手順**

1. 医療機関のデータを読み込む。
2. ラスタ＞ヒートマップを選択し、密度値を計算する。バンド幅を5000とする。 スタイルを調整する場合は、プロパティ＞スタイル＞バンド表示のレイヤタイプから単バンド疑似カラーを選択する。詳しくは、[空間データの結合・修正]教材の[ラスタのモザイク](https://github.com/yamauchi-inochu/demo/blob/master/GIS%E3%82%AA%E3%83%BC%E3%83%97%E3%83%B3%E6%95%99%E6%9D%90/10_%E7%A9%BA%E9%96%93%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E7%B5%B1%E5%90%88%E3%83%BB%E4%BF%AE%E6%AD%A3/%E7%A9%BA%E9%96%93%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E7%B5%B1%E5%90%88%E3%83%BB%E4%BF%AE%E6%AD%A3.md#ラスタのモザイク)の項目を参照する。
※ 今回はバンド幅によって、カーネルがどう平滑化されるかが、目視レベルで確認できれば良い。

3. 同様の手法で、バンド幅(半径)を2500と10000のものを作成し、課題4の質問に回答しなさい。

## <a name="第六回課題（20161108）"></a>第六回課題（20161108）

### 本日の課題
　前回の実習では、ポイントデータから領域を作成したり、ポリゴンデータを用いて、領域内と重なるポイントデータの密度を可視化する手法などについて学習しました。今回の実習では、ラスタデータを用いた地形情報の可視化や分析を行います。ラスターデータはベクトルデータと異なり、ピクセルごとに入力された値が分析に用いられまう。データの特徴の違いについては、[作業メモ]のベクトルデータとラスタデータの項目を参照してください。本実習では、ピクセルごとに標高値が入力された数値標高モデルを用います。[数値標高モデル](http://www.gsi.go.jp/KIDS/KIDS16.html)は、DEM（Digital Elevation Model）とよばれます。このデータを用いて、地形の可視化や分析の手法を学習します。
　また、本実習では各地点の標高点や地価（ベクターレイヤ）などのデータを用いて、未知のエリアの値を予測し、補間する手法（空間補間）についても学びます。実習では、標高点を不整三角網法で地価公示をIDWで補間する手法を学習します。
　課題データを活用し、以下の課題1～5に該当する地図を作成しなさい。
提出する地図は、凡例、方位、縮尺バー、タイトル（学籍番号、氏名、地図名）をレイアウトしたものとします。本課題と対応する教材は、[ラスタデータの分析]および[空間補間]の教材となります。実習ページより課題データをダウンロードし、実習を始めてください。

**使用データ**

実習データ①
　実習データは、国土地理院の基盤地図情報からダウンロードした香川県高松市周辺の5ｍDEMをエコリスのツールを用いて変換し、高松市北部の女木島周辺をトリミングしたものです。この手法については、[ラスタデータの分析]の教材をご参照ください。データの座標系は、世界測地系の平面直角座標Ⅳ系に設定しています。

実習データ②
　国土地理院の基盤地図情報からダウンロードした標高点と国土数値情報からダウンロードした地価公示データを用います。東京23区の範囲をクリップしたデータを課題データとして用意しています。実習ページより課題データをダウンロードし、実習を始めてください。データの座標系は、世界測地系（JGD2000）の平面直角座標Ⅸ系に設定しています。

**課題１:DEMデータの視覚的分析**
DEMデータを用いて、標高区分図、傾斜区分図、傾斜方位図、陰影図、鳥瞰図を作成し、レイアウトを行い。地形的な特徴を整理し、課題1に回答してください。

**手順**
1. 実習ページからダウンロードしたラスターデータをQGISで読み込む。
2. プロパティ＞透過性からデータなしとする値>データ無しの値に0を入力する。
3. ラスタ＞地形解析から傾斜、傾斜方位、陰影図を作成する。
4. 標高値、傾斜角、斜面方位（0°-360°）など、それぞれのラスターデータの値に応じて色分けを行い、標高区分図、傾斜区分図、傾斜方位図を作成する。
5. 陰影図をレイヤ順序の最下層とし、各ラスタデータの透過性を30％ほどにし、地形情報を視覚化する。
6. 平面では、確認しにくい箇所もあるため、プラグインの管理とインストールから、Qgis2threejsをインストールする。インストール後、起動し3Dモデルを作成する（鳥瞰図の作成）。
7. 作成した標高区分図、傾斜区分図、傾斜方位図、陰影図、鳥瞰図を視覚的に分析し、女木島の地形的な特徴を簡単にまとめ、課題1に記入する。


-------

**課題2:地形断面図の作成**
　DEMデータは、各セルに標高値を含んでいるため、複数のセルの標高値を利用し、断面図を作成することができます。本実習ではDEMデータを用いて、完成例のようにa-a'（女木島中央部北の標高186.3mを示す三角点付近をとおる西－東断線）, b-b'（女木島南部の標高216.0mを示す三角点付近をとおる北西-南東線）間の地形断面図を作成します。女木島北部と南部の断面形の特徴を整理し、課題フォームに簡単にまとめてください。

**完成例**
![kadai](pic/15-2.png)

**手順**
1. プラグインの管理とインストールから、Profile toolを検索し、インストールする。
2. QGISで読み込んだDEMデータを用いて、Profile toolで断面系を作成する。
3. 課題フォームに回答する。

※傾斜を比較する際は、ウィンドウの縦横比率や、取得した断面の長さに注意してください。

-------

**課題3:流域解析**
　課題3ではDEMデータを用いた、流域解析を行います。GRASS GISのプラグインを用いて、流域ポリゴンを作成し、流域とするセルの数を100として処理を行い、河川ごとに流域を抽出した地図を作成し、課題フォームから提出してください。
※今回は、河川ごとの細かい流域をグルーピングせず、支流、本流ごとの流域のものを作成する。

**完成例**
![kadai](pic/15-3.png)

今回の課題では、上の図の状態での提出で良いです。河川ごとに流域をグルーピングし、以下のような地図を作成することもできます。

![kadai](pic/15-3-1.png)


**手順**
1. [ラスタデータの分析]教材と[GRASSビギナーズマニュアル]を参考に、QGISのGRASSプラグインを利用し、マップセットを作成する。マップセットの作成については、[GRASSビギナーズマニュアル]のQGISでのマップセット作成の項目を参照してください。
2. マップセットに標高ラスタを読み込み、ラスタの範囲を設定する。
3. 流域解析を選択し、流域の最小セルサイズ100とする。
4. 流域と河川のラスタをベクトルに変換する。
5. 名前を付けて保存でベクトルレイヤしたのちに、地図をレイアウトし、提出する。

※ 地図が完成できなかった場合は、作業途中でレイアウトを行い、提出する地図中にできなかった理由を記載し（プリントコンポーザーのテキスト挿入機能）、提出してください。


--------

**課題4:空間補間**
　空間補間は、観測値などの既知のデータを用いて、周辺のデータを予測する際に用いる手法です。例えば、地価が高いA点と500ｍ離れている同じ地価のB点があると仮定した場合、中間のエリアも同じくらいの値になることが予想できます。空間補間では、周辺に分布する既知の値に応じて、値を算出します。空間補間法には、複数の種類があるため、値の分状況や対象とするデータの特性に応じてそれらの手法を選択します。
　今回の実習では、標高点のデータを不整三角網で、地価公示のデータをIDWで補間します。不整三角網は、近くの点を結び三角形で領域を分割し、角三角形ごとに値を補間する手法です。IDW（逆距離加重法）は、補間点から観測点までの距離（観測点までの距離の逆数）で重み付けを行い補間する手法です。詳しくは[講義用教材（8.　空間補間）](http://curricula.csis.u-tokyo.ac.jp/slide/4.html)の教材を参照してください。[空間補間]の教材を参考に、上記の2つの手法を用いて、地図を作成し、課題フォームの質問に回答してください。

**手順**
1. 新たにQGISを立ち上げ、課題データを読み込む。
2. ラスタ＞データ補間から、標高値を不整三角網法、地価公示をIDWで補間する。
3. 補間したデータを確認し、標高値と地価公示のデータを比較し、課題フォームの質問に回答してください。

--------

**任意課題：ラスタ演算（余裕があれば）**
複数のラスタデータの範囲と値を組み合わせて、ラスタを分析する手法を用います。本実習では、標高データと課題1で作成した傾斜のデータを用いて、ラスタ計算機で標高150m以上、傾斜10°以下のエリアを抽出する解析を行います。[ラスタデータの分析]教材を参考に処理を行い、抽出したエリアの特徴や形状をまとめてください。

**手順**
1. 標高と傾斜のデータをQGISで読み込みラスタからラスタ計算機を起動する。
2. 出力ファイルを設定し、以下の式を参考に値を入力する。
3. プロパティ＞スタイル＞単バンド疑似カラーを選択し、モードを等間隔、分類数を2とし、最小を0、最大を1とし分類をクリックする。0の値の色の不透明度を0％にするとみやすい。

```
 ( "標高ラスタ@1"  >=  150 )  AND  ( "傾斜ラスタ@1" <= 10  )
```



--------

#### 完成例で使用したデータ
本ページで使用しているデータの出典については、該当する教材よりご確認ください。

[△メニューへもどる]:実習課題.md#menu
[作業メモ]:https://github.com/yamauchi-inochu/demo/blob/master/GISオープン教材/実習課題/作業メモ.md
[QGISビギナーズマニュアル]:../QGISビギナーズマニュアル/QGISビギナーズマニュアル.md
[GRASSビギナーズマニュアル]:../GRASSビギナーズマニュアル/GRASSビギナーズマニュアル.md
[既存データの地図データと属性データ]:../07_既存データの地図データと属性データ/既存データの地図データと属性データ.md
[空間データ]:../08_空間データ/空間データ.md
[空間データの結合・修正]:../10_空間データの統合・修正/空間データの統合・修正.md
[視覚的伝達]:../21_視覚的伝達/視覚的伝達.md
[政府統計局e-stat]:https://www.e-stat.go.jp/SG1/estat/eStatTopPortal.do
[国土数値情報]:http://nlftp.mlit.go.jp/ksj/
[基本的な空間解析]:../11_基本的な空間解析/基本的な空間解析.md
[ネットワーク分析]:../12_ネットワーク分析/ネットワーク分析.md
[領域分析]:../13_領域分析/領域分析.md
[点データの分析]:../14_点データの分析/点データの分析.md
[ラスタデータの分析]:../15_ラスタデータの分析/ラスタデータの分析.md
[空間補間]:../18_空間補間/空間補間.md
